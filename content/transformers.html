

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Custom transformers &mdash; sklearn-xarray 0.1.2-alpha documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="sklearn-xarray 0.1.2-alpha documentation" href="../index.html"/>
        <link rel="next" title="API Reference" href="api.html"/>
        <link rel="prev" title="Pipelining and cross-validation" href="pipeline.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> sklearn-xarray
          

          
          </a>

          
            
            
              <div class="version">
                0.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrappers.html">Wrappers for sklearn estimators</a></li>
<li class="toctree-l1"><a class="reference internal" href="target.html">Using coordinates as targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipelining and cross-validation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Custom transformers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#transformers-changing-the-number-of-samples">Transformers changing the number of samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#groupwise-transformations">Groupwise transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrapping-custom-functions">Wrapping custom functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sklearn-xarray</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Custom transformers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/content/transformers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="custom-transformers">
<h1>Custom transformers<a class="headerlink" href="#custom-transformers" title="Permalink to this headline">¶</a></h1>
<p>sklearn-xarray provides a wealth of newly defined transformers that exploit
xarray’s powerful array manipulation syntax. Refer to <a class="reference internal" href="api.html#api-pre-processing"><span class="std std-ref">Pre-processing</span></a>
for a full list.</p>
<div class="section" id="transformers-changing-the-number-of-samples">
<h2>Transformers changing the number of samples<a class="headerlink" href="#transformers-changing-the-number-of-samples" title="Permalink to this headline">¶</a></h2>
<p>There are several transformers that change the number of samples in the data,
namely:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="api/preprocessing.html#sklearn_xarray.preprocessing.Resampler" title="sklearn_xarray.preprocessing.Resampler"><code class="xref py py-obj docutils literal"><span class="pre">Resampler</span></code></a></td>
<td>Resample along some dimension.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/preprocessing.html#sklearn_xarray.preprocessing.Sanitizer" title="sklearn_xarray.preprocessing.Sanitizer"><code class="xref py py-obj docutils literal"><span class="pre">Sanitizer</span></code></a></td>
<td>Remove elements containing NaNs.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/preprocessing.html#sklearn_xarray.preprocessing.Segmenter" title="sklearn_xarray.preprocessing.Segmenter"><code class="xref py py-obj docutils literal"><span class="pre">Segmenter</span></code></a></td>
<td>Split into segments along some dimension.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/preprocessing.html#sklearn_xarray.preprocessing.Splitter" title="sklearn_xarray.preprocessing.Splitter"><code class="xref py py-obj docutils literal"><span class="pre">Splitter</span></code></a></td>
<td>Split along some dimension.</td>
</tr>
</tbody>
</table>
<p>These kinds of transformer are usually disallowed by sklearn, because the
package does not provide any mechanism of also changing the number of samples
of the target in a pipelined supervised learning task. sklearn-xarray
circumvents this restriction with the <code class="xref py py-class docutils literal"><span class="pre">Target</span></code> class.</p>
<p>We look at an example where the digits dataset is loaded but some of the same
are corrupted and contain <code class="docutils literal"><span class="pre">nan</span></code> values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn_xarray</span> <span class="k">import</span> <span class="n">wrap</span><span class="p">,</span> <span class="n">Target</span>
<span class="kn">from</span> <span class="nn">sklearn_xarray.preprocessing</span> <span class="k">import</span> <span class="n">Sanitizer</span>
<span class="kn">from</span> <span class="nn">sklearn_xarray.data</span> <span class="k">import</span> <span class="n">load_digits_dataarray</span>

<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="k">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model.logistic</span> <span class="k">import</span> <span class="n">LogisticRegression</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">load_digits_dataarray</span><span class="p">(</span><span class="n">nan_probability</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="s1">&#39;digit&#39;</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;san&#39;</span><span class="p">,</span> <span class="n">Sanitizer</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="n">wrap</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">reshapes</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>If we had used <code class="docutils literal"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">X.digits</span></code> instead of the <code class="xref py py-class docutils literal"><span class="pre">Target</span></code> syntax, we
would have gotten:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ne">ValueError</span><span class="p">:</span> <span class="n">Found</span> <span class="nb">input</span> <span class="n">variables</span> <span class="k">with</span> <span class="n">inconsistent</span> <span class="n">numbers</span> <span class="n">of</span> <span class="n">samples</span><span class="p">:</span> <span class="p">[</span><span class="mi">1635</span><span class="p">,</span> <span class="mi">1797</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="groupwise-transformations">
<h2>Groupwise transformations<a class="headerlink" href="#groupwise-transformations" title="Permalink to this headline">¶</a></h2>
<p>When you apply transformers to your data that change the number of samples,
there are cases when you don’t want to apply the resampling operation to your
whole dataset, but rather groups of data.</p>
<p>One example is the WISDM activity recognition dataset found in the
<a class="reference internal" href="api/data.html#module-sklearn_xarray.data" title="sklearn_xarray.data"><code class="xref py py-mod docutils literal"><span class="pre">sklearn_xarray.data</span></code></a> module. It contains time series accelerometer
data from different subjects performing different activities. If, for
example, we wanted to split this dataset into segments of 20 samples, we
should do this in groups of subject/activity pairs, because otherwise we
could get non-continuous samples from different recording times in the same
segment. In order to perform transformations in a groupwise manner, we
specify the <code class="docutils literal"><span class="pre">groupby</span></code> parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn_xarray.data</span> <span class="k">import</span> <span class="n">load_wisdm_dataarray</span>
<span class="kn">from</span> <span class="nn">sklearn_xarray.preprocessing</span> <span class="k">import</span> <span class="n">Segmenter</span>

<span class="n">segmenter</span> <span class="o">=</span> <span class="n">Segmenter</span><span class="p">(</span>
    <span class="n">new_len</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">new_dim</span><span class="o">=</span><span class="s1">&#39;timepoint&#39;</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="s1">&#39;activity&#39;</span><span class="p">])</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">load_wisdm_dataarray</span><span class="p">()</span>
<span class="n">Xt</span> <span class="o">=</span> <span class="n">segmenter</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[]:</span> <span class="n">Xt</span>
<span class="n">Out</span><span class="p">[]:</span>
<span class="o">&lt;</span><span class="n">xarray</span><span class="o">.</span><span class="n">DataArray</span> <span class="p">(</span><span class="n">sample</span><span class="p">:</span> <span class="mi">54813</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">timepoint</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span><span class="o">&gt;</span>
<span class="n">array</span><span class="p">([[[</span> <span class="o">-</span><span class="mf">0.15</span>    <span class="p">,</span>   <span class="mf">0.11</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.26</span>    <span class="p">,</span>  <span class="o">-</span><span class="mf">1.46</span>    <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">9.15</span>    <span class="p">,</span>   <span class="mf">9.19</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>   <span class="mf">9.72</span>    <span class="p">,</span>   <span class="mf">9.81</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="o">-</span><span class="mf">0.34</span>    <span class="p">,</span>   <span class="mf">2.76</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>   <span class="mf">2.03</span>    <span class="p">,</span>   <span class="mf">2.15</span>    <span class="p">]],</span>
       <span class="p">[[</span>  <span class="mf">0.27</span>    <span class="p">,</span>  <span class="o">-</span><span class="mf">3.06</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.56</span>    <span class="p">,</span>  <span class="o">-</span><span class="mf">2.6</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">12.57</span>    <span class="p">,</span>  <span class="mf">13.18</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">14.56</span>    <span class="p">,</span>   <span class="mf">8.96</span>    <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">5.37</span>    <span class="p">,</span>   <span class="mf">6.47</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>   <span class="mf">0.31</span>    <span class="p">,</span>  <span class="o">-</span><span class="mf">3.3</span>     <span class="p">]],</span>
       <span class="o">...</span><span class="p">,</span>
       <span class="p">[[</span> <span class="o">-</span><span class="mf">0.3</span>     <span class="p">,</span>   <span class="mf">0.27</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>   <span class="mf">0.42</span>    <span class="p">,</span>   <span class="mf">3.17</span>    <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">8.08</span>    <span class="p">,</span>   <span class="mf">6.63</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">10.5</span>     <span class="p">,</span>   <span class="mf">9.23</span>    <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">0.994285</span><span class="p">,</span>   <span class="mf">0.994285</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="o">-</span><span class="mf">5.175732</span><span class="p">,</span>  <span class="o">-</span><span class="mf">4.671779</span><span class="p">]],</span>
       <span class="p">[[</span>  <span class="mf">5.33</span>    <span class="p">,</span>   <span class="mf">6.44</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="o">-</span><span class="mf">4.14</span>    <span class="p">,</span>  <span class="o">-</span><span class="mf">4.9</span>     <span class="p">],</span>
        <span class="p">[</span>  <span class="mf">8.39</span>    <span class="p">,</span>   <span class="mf">9.04</span>    <span class="p">,</span> <span class="o">...</span><span class="p">,</span>   <span class="mf">6.21</span>    <span class="p">,</span>   <span class="mf">6.55</span>    <span class="p">],</span>
        <span class="p">[</span> <span class="o">-</span><span class="mf">4.794363</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.179256</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>   <span class="mf">5.938472</span><span class="p">,</span>   <span class="mf">3.827318</span><span class="p">]]])</span>
<span class="n">Coordinates</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">timepoint</span>  <span class="p">(</span><span class="n">timepoint</span><span class="p">)</span> <span class="n">int32</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="o">...</span>
  <span class="o">*</span> <span class="n">axis</span>       <span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">U1</span> <span class="s1">&#39;x&#39;</span> <span class="s1">&#39;y&#39;</span> <span class="s1">&#39;z&#39;</span>
  <span class="o">*</span> <span class="n">sample</span>     <span class="p">(</span><span class="n">sample</span><span class="p">)</span> <span class="n">timedelta64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="mi">13</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mf">37.050000</span> <span class="mi">13</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mf">38.050000</span> <span class="o">...</span>
    <span class="n">subject</span>    <span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">timepoint</span><span class="p">)</span> <span class="n">int64</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">...</span>
    <span class="n">activity</span>   <span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">timepoint</span><span class="p">)</span> <span class="nb">object</span> <span class="s1">&#39;Downstairs&#39;</span> <span class="s1">&#39;Downstairs&#39;</span> <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unfortunately, xarray does not support groupwise operations with multiple
coordinates to group over (yet). Therefore the samples are not guaranteed
to be in the same order after applying a groupwise transformation.</p>
</div>
</div>
<div class="section" id="wrapping-custom-functions">
<h2>Wrapping custom functions<a class="headerlink" href="#wrapping-custom-functions" title="Permalink to this headline">¶</a></h2>
<p>With <a class="reference internal" href="api/preprocessing.html#sklearn_xarray.preprocessing.preprocess" title="sklearn_xarray.preprocessing.preprocess"><code class="xref py py-func docutils literal"><span class="pre">preprocess()</span></code></a> you can wrap any function that doesn’t change the
shape of the data and apply it to a <code class="docutils literal"><span class="pre">DataArray</span></code> or <code class="docutils literal"><span class="pre">Dataset</span></code>. The function
also supports groupwise transformations.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pipeline.html" class="btn btn-neutral" title="Pipelining and cross-validation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Peter Hausamann.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>